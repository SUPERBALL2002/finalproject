import React, { useState, useEffect } from "react";
import { Link, useNavigate } from "react-router-dom";
import styles from "./HomePage.module.css";

const HomePage = () => {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [activeSubject, setActiveSubject] = useState(null);
  const [showPopup, setShowPopup] = useState(false); // popup logout ‡πÄ‡∏î‡∏¥‡∏°
  const [showLoginPopup, setShowLoginPopup] = useState(false); // popup ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const navigate = useNavigate();

  useEffect(() => {
    const token = localStorage.getItem("userToken");
    if (!token || token === "false") {
      navigate("/login");
    } else {
      setIsLoggedIn(true);
    }
  }, [navigate]);

  const toggleSidebar = () => {
    setSidebarOpen(!sidebarOpen);
  };

  const handleSubjectClick = (subject) => {
    const token = localStorage.getItem("userToken");
    if (!token || token === "false") {
      setShowLoginPopup(true);
      return;
    }

    setActiveSubject(subject);
    if (subject === "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå") navigate("/math");
    else if (subject === "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå") navigate("/science");
    else if (subject === "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢") navigate("/thailanguage");
    else if (subject === "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©") navigate("/englanguage");
  };

  const handleLogoutClick = () => {
    setShowPopup(true);
  };

  const handleLogout = () => {
    localStorage.removeItem("userToken");
    navigate("/login");
  };

  const cancelLogout = () => {
    setShowPopup(false);
  };

  const closeLoginPopup = () => {
    setShowLoginPopup(false);
  };

  return (
    <div className={styles.homePageWrapper}>
      <header className={styles.homePageHeader}>
        <h1>üìö ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ô‡∏∏‡∏Å ‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤!</h1>
        <p>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏ô‡∏∏‡∏Å ‡πÑ‡∏î‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å ‡πÜ ‡πÄ‡∏û‡∏•‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏¥‡∏ô</p>
        <nav className={styles.homePageNavbar}>
          <div className={styles.navLeft}></div>
          <div className={styles.navRight}>
            <div className={styles.profileSection} onClick={toggleSidebar}>
              <img src="avatar.png" alt="Profile" className={styles.profileIcon} />
              <span className={styles.profileName}> </span>
            </div>
          </div>
        </nav>
      </header>

      <div className={`${styles.homePageSidebar} ${sidebarOpen ? styles.homePageSidebarOpen : ""}`} style={{ zIndex: 1100 }}>
        <button className={styles.homePageCloseBtn} onClick={toggleSidebar}>‚úñ</button>
        <ul>
          {!isLoggedIn && (
            <li><Link to="/login" className={styles.homePageSidebarButton}>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</Link></li>
          )}

          {isLoggedIn && (
            <>
              <li><Link to="/profile" className={styles.homePageSidebarButton}>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</Link></li>
              <li><Link to="/account-settings" className={styles.homePageSidebarButton}>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</Link></li>
              <li><Link to="/minigame" className={styles.homePageSidebarButton}>‡πÄ‡∏Å‡∏°‡∏™‡πå</Link></li>
              <li><button onClick={handleLogoutClick} className={styles.homePageSidebarButton}>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></li>
            </>
          )}
        </ul>
      </div>

      <div className={styles.homePageGridContainer}>
        {[{ icon: "üìè", name: "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" }, { icon: "üî¨", name: "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå" }, { icon: "üìñ", name: "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢" }, { icon: "üåç", name: "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©" }].map((subject) => (
          <button
            key={subject.name}
            className={`${styles.homePageSubject} ${activeSubject === subject.name ? styles.active : ""}`}
            onClick={() => handleSubjectClick(subject.name)}
          >
            {subject.icon} {subject.name}
          </button>
        ))}
      </div>

      {/* ‚úÖ Popup ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö */}
      {showPopup && (
        <div className={styles.homePagePopupBackground}>
          <div className={styles.homePagePopupContainer}>
            <p>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</p>
            <div className={styles.homePagePopupButtons}>
              <button onClick={handleLogout} className={styles.homePagePopupConfirmButton}>‡∏ï‡∏Å‡∏•‡∏á</button>
              <button onClick={cancelLogout} className={styles.homePagePopupCancelButton}>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
          </div>
        </div>
      )}

      {/* ‚úÖ Popup ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö */}
      {showLoginPopup && (
        <div className={styles.homePagePopupBackground}>
          <div className={styles.homePagePopupContainer}>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
            <div className={styles.homePagePopupButtons}>
              <button onClick={() => navigate("/login")} className={styles.homePagePopupConfirmButton}>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
              <button onClick={closeLoginPopup} className={styles.homePagePopupCancelButton}>‡∏õ‡∏¥‡∏î</button>
            </div>
          </div>
        </div>
      )}

      <footer className={styles.homePageFooter}>
        <h2>‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>
        <p>
          ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å ‡πÜ ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
          ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
        </p>

        <h3>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h3>
        <ul>
          <li>‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢</li>
          <li>‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å</li>
          <li>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏á‡πà‡∏≤‡∏¢</li>
          <li>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏¢</li>
        </ul>

        <h3>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h3>
        <p>
          ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: <a href="mailto:karan@gmail.com">karan@gmail.com</a> <br />
          ‡πÇ‡∏ó‡∏£: <a href="tel:+66971234567">+66 9712 34567</a>
        </p>
      </footer>
    </div>
  );
};

export default HomePage;